{"version":3,"file":"button.min.js","sources":["../src/button.js"],"sourcesContent":["define(['jquery', 'core/ajax'], function($, ajax) {\n    return {\n        init: function(params) {\n            console.log(\"JavaScript wird geladen!\");\n            var userId = params;\n            var courseId = $('body').attr('class').match(/course-(\\d+)/);\n            courseId = courseId ? courseId[1] : null;\n\n            if (!userId || !courseId) {\n                console.error(\"Fehler: userId oder courseId fehlen!\");\n                return;\n            }\n\n            // F端ge Buttons zu jedem Section-Titel hinzu, falls noch nicht vorhanden\n            $('.sectionname').each(function() {\n                var sectionTitle = $(this);\n                var sectionId = sectionTitle.closest('[id^=\"section-\"]').attr('id').replace('section-', '');\n\n                // API Call: Pr端fen, ob die Lernplanfunktion f端r die Sektion aktiv ist\n                ajax.call([{\n                    methodname: 'local_learningplan_get_section_option',\n                    args: {\n                        sectionid: sectionId,\n                        courseid: courseId\n                    },\n                    done: function(response) {\n\n                        if (!sectionTitle.find('.learningplan-save-button').length) {\n                            let button = $('<button>')\n                                .addClass('btn btn-icon btn-primary learningplan-save-button')\n                                .attr('data-section-id', sectionId)\n                                .attr('data-course-id', courseId)\n                                .attr('data-user-id', userId)\n                                .html('<i class=\"icon fa fa-save\"></i>');\n\n                            ajax.call([{\n                                methodname: 'local_learningplan_check_section_data',\n                                args: {\n                                    courseid: courseId,\n                                    sectionid: sectionId,\n                                    userid: userId\n                                },\n                                done: function(response) {\n                                    let icon = button.find('i');\n                                    if (response) {\n                                        icon.removeClass('fa-save').addClass('fa-trash');\n                                        button.removeClass('btn-primary').addClass('btn-danger');\n                                    }\n                                },\n                                fail: function(error) {\n                                    console.error('Fehler:', error);\n                                }\n                            }]);\n\n                            sectionTitle.prepend(button);\n\n                            if (response === 0) {\n                                console.log(\"Lernplan f端r Abschnitt \" + sectionId + \" ist deaktiviert. Button nicht sichtbar.\");\n                                button.hide();\n                            }\n                        }\n                    },\n                    fail: function(error) {\n                        console.error('Fehler beim Abrufen der Lernplan-Option:', error);\n                    }\n                }]);\n            });\n\n            $(document).on('click', '.learningplan-save-button', function() {\n                var button = $(this);\n                var courseId = button.data('course-id');\n                var sectionId = button.data('section-id');\n                var userId = button.data('user-id');\n                var currentIcon = button.find('i');\n\n                if (currentIcon.hasClass('fa-save')) {\n                    ajax.call([{\n                        methodname: 'local_learningplan_save_section_data',\n                        args: {\n                            courseid: courseId,\n                            sectionid: sectionId,\n                            userid: userId\n                        },\n                        done: function() {\n                            currentIcon.removeClass('fa-save').addClass('fa-trash');\n                            button.removeClass('btn-primary').addClass('btn-danger');\n                        },\n                        fail: function(error) {\n                            console.log('Fehler:', error);\n                            alert('Fehler beim Speichern der Daten.');\n                        }\n                    }]);\n                } else if (currentIcon.hasClass('fa-trash')) {\n                    ajax.call([{\n                        methodname: 'local_learningplan_delete_section_data',\n                        args: {\n                            courseid: courseId,\n                            sectionid: sectionId,\n                            userid: userId\n                        },\n                        done: function() {\n                            currentIcon.removeClass('fa-trash').addClass('fa-save');\n                            button.removeClass('btn-danger').addClass('btn-primary');\n                        },\n                        fail: function(error) {\n                            console.log('Fehler:', error);\n                            alert('Fehler beim Entfernen der Daten.');\n                        }\n                    }]);\n                }\n            });\n        }\n    };\n});\n"],"names":["define","$","ajax","init","params","console","log","userId","courseId","attr","match","each","sectionTitle","this","sectionId","closest","replace","call","methodname","args","sectionid","courseid","done","response","find","length","button","addClass","html","userid","icon","removeClass","fail","error","prepend","hide","document","on","data","currentIcon","hasClass","alert"],"mappings":"AAAAA,mCAAO,CAAC,SAAU,cAAc,SAASC,EAAGC,YACjC,CACHC,KAAM,SAASC,QACXC,QAAQC,IAAI,gCACRC,OAASH,OACTI,SAAWP,EAAE,QAAQQ,KAAK,SAASC,MAAM,gBAC7CF,SAAWA,SAAWA,SAAS,GAAK,KAE/BD,QAAWC,UAMhBP,EAAE,gBAAgBU,MAAK,eACfC,aAAeX,EAAEY,MACjBC,UAAYF,aAAaG,QAAQ,oBAAoBN,KAAK,MAAMO,QAAQ,WAAY,IAGxFd,KAAKe,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CACFC,UAAWN,UACXO,SAAUb,UAEdc,KAAM,SAASC,cAENX,aAAaY,KAAK,6BAA6BC,OAAQ,KACpDC,OAASzB,EAAE,YACV0B,SAAS,qDACTlB,KAAK,kBAAmBK,WACxBL,KAAK,iBAAkBD,UACvBC,KAAK,eAAgBF,QACrBqB,KAAK,mCAEV1B,KAAKe,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CACFE,SAAUb,SACVY,UAAWN,UACXe,OAAQtB,QAEZe,KAAM,SAASC,cACPO,KAAOJ,OAAOF,KAAK,KACnBD,WACAO,KAAKC,YAAY,WAAWJ,SAAS,YACrCD,OAAOK,YAAY,eAAeJ,SAAS,gBAGnDK,KAAM,SAASC,OACX5B,QAAQ4B,MAAM,UAAWA,WAIjCrB,aAAasB,QAAQR,QAEJ,IAAbH,WACAlB,QAAQC,IAAI,0BAA4BQ,UAAY,4CACpDY,OAAOS,UAInBH,KAAM,SAASC,OACX5B,QAAQ4B,MAAM,2CAA4CA,cAKtEhC,EAAEmC,UAAUC,GAAG,QAAS,6BAA6B,eAC7CX,OAASzB,EAAEY,MACXL,SAAWkB,OAAOY,KAAK,aACvBxB,UAAYY,OAAOY,KAAK,cACxB/B,OAASmB,OAAOY,KAAK,WACrBC,YAAcb,OAAOF,KAAK,KAE1Be,YAAYC,SAAS,WACrBtC,KAAKe,KAAK,CAAC,CACPC,WAAY,uCACZC,KAAM,CACFE,SAAUb,SACVY,UAAWN,UACXe,OAAQtB,QAEZe,KAAM,WACFiB,YAAYR,YAAY,WAAWJ,SAAS,YAC5CD,OAAOK,YAAY,eAAeJ,SAAS,eAE/CK,KAAM,SAASC,OACX5B,QAAQC,IAAI,UAAW2B,OACvBQ,MAAM,wCAGPF,YAAYC,SAAS,aAC5BtC,KAAKe,KAAK,CAAC,CACPC,WAAY,yCACZC,KAAM,CACFE,SAAUb,SACVY,UAAWN,UACXe,OAAQtB,QAEZe,KAAM,WACFiB,YAAYR,YAAY,YAAYJ,SAAS,WAC7CD,OAAOK,YAAY,cAAcJ,SAAS,gBAE9CK,KAAM,SAASC,OACX5B,QAAQC,IAAI,UAAW2B,OACvBQ,MAAM,4CAjGlBpC,QAAQ4B,MAAM"}