{"version":3,"file":"button.min.js","sources":["../src/button.js"],"sourcesContent":["define(['jquery', 'core/ajax'], function($, ajax) {\n    return {\n        init: function(params) {\n            let userId = params;\n            let courseId = $('body').attr('class').match(/course-(\\d+)/);\n            courseId = courseId ? courseId[1] : null;\n\n            if (!userId || !courseId) {\n                return;\n            }\n\n            // Add a button to each section title if not already present\n            $('.sectionname').each(function() {\n                let sectionTitle = $(this);\n                let sectionId = sectionTitle.closest('[id^=\"section-\"]').attr('id').replace('section-', '');\n\n                // API Call: Check whether the learning plan function is active for the section\n                ajax.call([{\n                    methodname: 'local_learningplan_get_section_option',\n                    args: {\n                        sectionid: sectionId,\n                        courseid: courseId\n                    },\n                    done: function(response) {\n\n                        if (!sectionTitle.find('.learningplan-save-button').length) {\n                            let button = $('<button>')\n                                .addClass('btn learningplan-save-button')\n                                .attr('data-section-id', sectionId)\n                                .attr('data-course-id', courseId)\n                                .attr('data-user-id', userId)\n                                .html('<i class=\"icon fa-regular fa-bookmark\"></i>');\n\n                            ajax.call([{\n                                methodname: 'local_learningplan_check_section_data',\n                                args: {\n                                    courseid: courseId,\n                                    sectionid: sectionId,\n                                    userid: userId\n                                },\n                                done: function(response) {\n                                    let icon = button.find('i');\n                                    if (response) {\n                                        icon.removeClass('fa-regular').addClass('fa-solid');\n                                    }\n                                },\n                                fail: function(error) {\n                                    console.error('Error:', error);\n                                }\n                            }]);\n\n                            sectionTitle.prepend(button);\n\n                            if (response === 0) {\n                                button.hide();\n                            }\n                        }\n                    },\n                    fail: function(error) {\n                        console.error('Error when retrieving the learning plan option:', error);\n                    }\n                }]);\n            });\n\n            // Aktion f√ºr den Klick auf den Learningplan-Button\n            $(document).on('click', '.learningplan-save-button', function() {\n                let button = $(this);\n                let courseId = button.data('course-id');\n                let sectionId = button.data('section-id');\n                let userId = button.data('user-id');\n                let currentIcon = button.find('i');\n\n                if (currentIcon.hasClass('fa-regular')) {\n                    ajax.call([{\n                        methodname: 'local_learningplan_save_section_data',\n                        args: {\n                            courseid: courseId,\n                            sectionid: sectionId,\n                            userid: userId\n                        },\n                        done: function() {\n                            currentIcon.removeClass('fa-regular').addClass('fa-solid');\n                        },\n                        fail: function(error) {\n                            console.error('Error:', error);\n                        }\n                    }]);\n                } else if (currentIcon.hasClass('fa-solid')) {\n                    ajax.call([{\n                        methodname: 'local_learningplan_delete_section_data',\n                        args: {\n                            courseid: courseId,\n                            sectionid: sectionId,\n                            userid: userId\n                        },\n                        done: function() {\n                            currentIcon.removeClass('fa-solid').addClass('fa-regular');\n                        },\n                        fail: function(error) {\n                            console.error('Error:', error);\n                        }\n                    }]);\n                }\n            });\n        }\n    };\n});\n"],"names":["define","$","ajax","init","params","userId","courseId","attr","match","each","sectionTitle","this","sectionId","closest","replace","call","methodname","args","sectionid","courseid","done","response","find","length","button","addClass","html","userid","icon","removeClass","fail","error","console","prepend","hide","document","on","data","currentIcon","hasClass"],"mappings":"AAAAA,mCAAO,CAAC,SAAU,cAAc,SAASC,EAAGC,YACjC,CACHC,KAAM,SAASC,YACPC,OAASD,OACTE,SAAWL,EAAE,QAAQM,KAAK,SAASC,MAAM,gBAC7CF,SAAWA,SAAWA,SAAS,GAAK,KAE/BD,QAAWC,WAKhBL,EAAE,gBAAgBQ,MAAK,eACfC,aAAeT,EAAEU,MACjBC,UAAYF,aAAaG,QAAQ,oBAAoBN,KAAK,MAAMO,QAAQ,WAAY,IAGxFZ,KAAKa,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CACFC,UAAWN,UACXO,SAAUb,UAEdc,KAAM,SAASC,cAENX,aAAaY,KAAK,6BAA6BC,OAAQ,KACpDC,OAASvB,EAAE,YACVwB,SAAS,gCACTlB,KAAK,kBAAmBK,WACxBL,KAAK,iBAAkBD,UACvBC,KAAK,eAAgBF,QACrBqB,KAAK,+CAEVxB,KAAKa,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CACFE,SAAUb,SACVY,UAAWN,UACXe,OAAQtB,QAEZe,KAAM,SAASC,cACPO,KAAOJ,OAAOF,KAAK,KACnBD,UACAO,KAAKC,YAAY,cAAcJ,SAAS,aAGhDK,KAAM,SAASC,OACXC,QAAQD,MAAM,SAAUA,WAIhCrB,aAAauB,QAAQT,QAEJ,IAAbH,UACAG,OAAOU,SAInBJ,KAAM,SAASC,OACXC,QAAQD,MAAM,kDAAmDA,cAM7E9B,EAAEkC,UAAUC,GAAG,QAAS,6BAA6B,eAC7CZ,OAASvB,EAAEU,MACXL,SAAWkB,OAAOa,KAAK,aACvBzB,UAAYY,OAAOa,KAAK,cACxBhC,OAASmB,OAAOa,KAAK,WACrBC,YAAcd,OAAOF,KAAK,KAE1BgB,YAAYC,SAAS,cACrBrC,KAAKa,KAAK,CAAC,CACPC,WAAY,uCACZC,KAAM,CACFE,SAAUb,SACVY,UAAWN,UACXe,OAAQtB,QAEZe,KAAM,WACFkB,YAAYT,YAAY,cAAcJ,SAAS,aAEnDK,KAAM,SAASC,OACXC,QAAQD,MAAM,SAAUA,WAGzBO,YAAYC,SAAS,aAC5BrC,KAAKa,KAAK,CAAC,CACPC,WAAY,yCACZC,KAAM,CACFE,SAAUb,SACVY,UAAWN,UACXe,OAAQtB,QAEZe,KAAM,WACFkB,YAAYT,YAAY,YAAYJ,SAAS,eAEjDK,KAAM,SAASC,OACXC,QAAQD,MAAM,SAAUA"}