{"version":3,"file":"button.min.js","sources":["../src/button.js"],"sourcesContent":["define(['jquery', 'core/ajax'], function($, ajax) {\n    return {\n        init: function(params) {\n            console.log(\"JavaScript wird geladen!\");\n            var userId = params; // Hier wird nur der User übergeben\n            var courseId = $('body').attr('class').match(/course-(\\d+)/);\n            courseId = courseId ? courseId[1] : null; // Verhindert Fehler, falls nicht gefunden\n\n            if (!userId || !courseId) {\n                console.error(\"Fehler: userId oder courseId fehlen!\");\n                return;\n            }\n\n            // Füge Buttons zu jedem Section-Titel hinzu, falls noch nicht vorhanden\n            $('.sectionname').each(function() {\n                var sectionTitle = $(this);\n                var sectionId = sectionTitle.closest('[id^=\"section-\"]').attr('id').replace('section-', '');\n\n                if (!sectionTitle.find('.learningplan-save-button').length) {\n                    let button = $('<button>')\n                        .addClass('btn btn-icon btn-primary learningplan-save-button')\n                        .attr('data-section-id', sectionId)\n                        .attr('data-course-id', courseId)\n                        .attr('data-user-id', userId)\n                        //.text('Laden...');\n                        .html('<i class=\"icon fa fa-save\"></i>');\n\n\n                    ajax.call([{\n                        methodname: 'local_learningplan_check_section_data',\n                        args: {\n                            courseid: courseId,\n                            sectionid: sectionId,\n                            userid: userId\n                        },\n                        done: function(response) {\n                            console.log('Server-Antwort learningplan_check: ' + response);\n                            let icon = button.find('i');\n                            console.log(icon.hasClass('fa-save'));\n                            if (response) {\n                                //button.text('Entfernen');\n                                console.log('Ändere Button zu trash');\n                                if (icon.hasClass('fa-save')) {\n                                    icon.removeClass('fa-save').addClass('fa-trash');\n                                    button.removeClass('btn-primary').addClass('btn-danger');\n                                }\n                            } else {\n                                //button.text('Speichern');\n                                console.log('Ändere Button zu save');\n                                if (icon.hasClass('fa-trash')) {\n                                    icon.removeClass('fa-trash').addClass('fa-save');\n                                    button.removeClass('btn-danger').addClass('btn-primary');\n                                }\n                            }\n                        },\n                        fail: function(error) {\n                            console.error('Fehler:', error);\n                        }\n                    }]);\n\n                    sectionTitle.prepend(button);\n                }\n            });\n            //\n            // $('.learningplan-save-button').each(function() {\n            //     var button = $(this);\n            //     var courseId = button.data('course-id');\n            //     var sectionId = button.data('section-id');\n            //     var userId = button.data('user-id');\n            //\n            //     // Überprüfen, ob die Section gespeichert ist\n            //     ajax.call([{\n            //         methodname: 'local_learningplan_check_section_data',\n            //         args: {\n            //             courseid: courseId,\n            //             sectionid: sectionId,\n            //             userid: userId\n            //         },\n            //         done: function(response) {\n            //             console.log('Server-Antwort learningplan_check: ' + response);\n            //             let icon = $(this).find('i');\n            //             if (response) {\n            //                 //button.text('Entfernen');\n            //                 if (icon.hasClass('fa-save')) {\n            //                     icon.removeClass('fa-save').addClass('fa-trash');\n            //                     button.removeClass('btn-primary').addClass('btn-danger');\n            //                 }\n            //             } else {\n            //                 //button.text('Speichern');\n            //                 if (icon.hasClass('fa-trash')) {\n            //                     icon.removeClass('fa-trash').addClass('fa-save');\n            //                     button.removeClass('btn-danger').addClass('btn-primary');\n            //                 }\n            //             }\n            //         },\n            //         fail: function(error) {\n            //             console.error('Fehler:', error);\n            //         }\n            //     }]);\n            // });\n\n\n            $(document).on('click', '.learningplan-save-button', function() {\n                var button = $(this);\n                var courseId = button.data('course-id');\n                var sectionId = button.data('section-id');\n                var userId = button.data('user-id');\n\n                //var currentText = button.text().trim();\n                //console.log('currentText:' + currentText);\n                var currentIcon = button.find('i');\n\n                //if (currentText === 'Speichern') {\n                if (currentIcon.hasClass('fa-save')) {\n                    ajax.call([{\n                        methodname: 'local_learningplan_save_section_data',\n                        args: {\n                            courseid: courseId,\n                            sectionid: sectionId,\n                            userid: userId\n                        },\n                        done: function() {\n                            //button.text('Entfernen').prop('disabled', false);\n                            currentIcon.removeClass('fa-save').addClass('fa-trash');\n                            button.removeClass('btn-primary').addClass('btn-danger');\n                        },\n                        fail: function(error) {\n                            console.log('Fehler:', error);\n                            alert('Fehler beim Speichern der Daten.');\n                        }\n                    }]);\n                //} else if (currentText === 'Entfernen') {\n                } else if (currentIcon.hasClass('fa-trash')) {\n                    ajax.call([{\n                        methodname: 'local_learningplan_delete_section_data',\n                        args: {\n                            courseid: courseId,\n                            sectionid: sectionId,\n                            userid: userId\n                        },\n                        done: function() {\n                            //.text('Speichern').prop('disabled', false);\n                            currentIcon.removeClass('fa-trash').addClass('fa-save');\n                            button.removeClass('btn-danger').addClass('btn-primary');\n                        },\n                        fail: function(error) {\n                            console.log('Fehler:', error);\n                            alert('Fehler beim Entfernen der Daten.');\n                        }\n                    }]);\n                }\n            });\n        }\n    };\n});\n"],"names":["define","$","ajax","init","params","console","log","userId","courseId","attr","match","each","sectionTitle","this","sectionId","closest","replace","find","length","button","addClass","html","call","methodname","args","courseid","sectionid","userid","done","response","icon","hasClass","removeClass","fail","error","prepend","document","on","data","currentIcon","alert"],"mappings":"AAAAA,mCAAO,CAAC,SAAU,cAAc,SAASC,EAAGC,YACjC,CACHC,KAAM,SAASC,QACXC,QAAQC,IAAI,gCACRC,OAASH,OACTI,SAAWP,EAAE,QAAQQ,KAAK,SAASC,MAAM,gBAC7CF,SAAWA,SAAWA,SAAS,GAAK,KAE/BD,QAAWC,UAMhBP,EAAE,gBAAgBU,MAAK,eACfC,aAAeX,EAAEY,MACjBC,UAAYF,aAAaG,QAAQ,oBAAoBN,KAAK,MAAMO,QAAQ,WAAY,QAEnFJ,aAAaK,KAAK,6BAA6BC,OAAQ,KACpDC,OAASlB,EAAE,YACVmB,SAAS,qDACTX,KAAK,kBAAmBK,WACxBL,KAAK,iBAAkBD,UACvBC,KAAK,eAAgBF,QAErBc,KAAK,mCAGVnB,KAAKoB,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CACFC,SAAUjB,SACVkB,UAAWZ,UACXa,OAAQpB,QAEZqB,KAAM,SAASC,UACXxB,QAAQC,IAAI,sCAAwCuB,cAChDC,KAAOX,OAAOF,KAAK,KACvBZ,QAAQC,IAAIwB,KAAKC,SAAS,YACtBF,UAEAxB,QAAQC,IAAI,0BACRwB,KAAKC,SAAS,aACdD,KAAKE,YAAY,WAAWZ,SAAS,YACrCD,OAAOa,YAAY,eAAeZ,SAAS,iBAI/Cf,QAAQC,IAAI,yBACRwB,KAAKC,SAAS,cACdD,KAAKE,YAAY,YAAYZ,SAAS,WACtCD,OAAOa,YAAY,cAAcZ,SAAS,kBAItDa,KAAM,SAASC,OACX7B,QAAQ6B,MAAM,UAAWA,WAIjCtB,aAAauB,QAAQhB,YA0C7BlB,EAAEmC,UAAUC,GAAG,QAAS,6BAA6B,eAC7ClB,OAASlB,EAAEY,MACXL,SAAWW,OAAOmB,KAAK,aACvBxB,UAAYK,OAAOmB,KAAK,cACxB/B,OAASY,OAAOmB,KAAK,WAIrBC,YAAcpB,OAAOF,KAAK,KAG1BsB,YAAYR,SAAS,WACrB7B,KAAKoB,KAAK,CAAC,CACPC,WAAY,uCACZC,KAAM,CACFC,SAAUjB,SACVkB,UAAWZ,UACXa,OAAQpB,QAEZqB,KAAM,WAEFW,YAAYP,YAAY,WAAWZ,SAAS,YAC5CD,OAAOa,YAAY,eAAeZ,SAAS,eAE/Ca,KAAM,SAASC,OACX7B,QAAQC,IAAI,UAAW4B,OACvBM,MAAM,wCAIPD,YAAYR,SAAS,aAC5B7B,KAAKoB,KAAK,CAAC,CACPC,WAAY,yCACZC,KAAM,CACFC,SAAUjB,SACVkB,UAAWZ,UACXa,OAAQpB,QAEZqB,KAAM,WAEFW,YAAYP,YAAY,YAAYZ,SAAS,WAC7CD,OAAOa,YAAY,cAAcZ,SAAS,gBAE9Ca,KAAM,SAASC,OACX7B,QAAQC,IAAI,UAAW4B,OACvBM,MAAM,4CA1IlBnC,QAAQ6B,MAAM"}