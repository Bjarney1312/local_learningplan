{"version":3,"file":"sectionmenu.min.js","sources":["../src/sectionmenu.js"],"sourcesContent":["define(['jquery', 'core/ajax', 'core/str'], function($, ajax, str) {\n    let langStrings = {};\n\n    /**\n     * Loading language strings for chosen language.\n     */\n    function loadLangStrings() {\n        return str.get_strings([\n            {key: 'learningplan_activate', component: 'local_learningplan'},\n            {key: 'learningplan_deactivate', component: 'local_learningplan'}\n        ]).done(function(strings) {\n            langStrings.activate = strings[0];\n            langStrings.deactivate = strings[1];\n        }).fail(function() {\n            console.error('Error loading the language strings');\n        });\n    }\n    return {\n        init: function() {\n            loadLangStrings().done(function() {\n                $(document).on('click', '.section-actions .dropdown-toggle', function() {\n                    let menu = $(this).closest('.dropdown').find('.dropdown-menu');\n\n                    if (!menu.length || menu.find('.learningplan-menu-item').length) {\n                        return;\n                    }\n\n                    let sectionId = $(this).closest('.section').attr('id')?.replace('section-', '');\n                    let courseId = $('body').attr('class').match(/course-(\\d+)/);\n                    courseId = courseId ? courseId[1] : null;\n\n                    if (!sectionId || !courseId) {\n                        return;\n                    }\n\n                    // API Call: Check whether the section is already in the DB\n                    ajax.call([{\n                        methodname: 'local_learningplan_get_section_option',\n                        args: {\n                            sectionid: sectionId,\n                            courseid: courseId\n                        },\n                        done: function(response) {\n                            let menuItem = $('<a href=\"#\" class=\"dropdown-item learningplan-menu-item\">')\n                                .html('<i class=\"icon fa fa-list-alt fa-fw\"></i> ' +\n                                    (response === 1 ? langStrings.deactivate : langStrings.activate))\n                                .on('click', function(e) {\n                                    e.preventDefault();\n                                    toggleLearningPlanSetting(sectionId, courseId, menuItem);\n                                });\n\n                            menu.append(menuItem);\n\n                            let sectionButton = $('.section-' + sectionId + ' .learningplan-save-button');\n                            if (response === 0) {\n                                sectionButton.hide();\n                                ajax.call([{\n                                    methodname: 'local_learningplan_delete_section_data_for_all',\n                                    args: {\n                                        courseid: courseId,\n                                        sectionid: sectionId\n                                    },\n                                    done: function() {\n                                        sectionButton.find('i').removeClass('fa-solid').addClass('fa-regular');\n                                    },\n                                    fail: function(error) {\n                                        console.error('Error when removing the entries', error);\n                                    }\n                                }]);\n                            } else {\n                                sectionButton.show();\n                            }\n                        },\n                        fail: function(error) {\n                            console.error('Error when retrieving the setting', error);\n                        }\n                    }]);\n                });\n\n                /**\n                 * Updates the item menu to enable or disable the option to add the section to the learning plan.\n                 * @param {number} sectionId Number of the section in the course\n                 * @param {number} courseId ID of the course\n                 * @param {number} menuItem Menu Item\n                 */\n                function toggleLearningPlanSetting(sectionId, courseId, menuItem) {\n                    ajax.call([{\n                        methodname: 'local_learningplan_toggle_section_option',\n                        args: {\n                            sectionid: sectionId,\n                            courseid: courseId\n                        },\n                        done: function(newvalue) {\n                            let newText = (newvalue === 1 ? langStrings.deactivate : langStrings.activate);\n                            menuItem.html('<i class=\"icon fa fa-list-alt fa-fw\"></i> ' + newText);\n\n                            let sectionButton = $('[data-section-id=\"' + sectionId + '\"].learningplan-save-button');\n                            if (newvalue === 0) {\n                                sectionButton.hide();\n                                ajax.call([{\n                                    methodname: 'local_learningplan_delete_section_data_for_all',\n                                    args: {\n                                        courseid: courseId,\n                                        sectionid: sectionId\n                                    },\n                                    done: function() {\n                                        sectionButton.find('i').removeClass('fa-solid').addClass('fa-regular');\n                                    },\n                                    fail: function(error) {\n                                        console.error('Error when removing the entries', error);\n                                    }\n                                }]);\n                            } else {\n                                sectionButton.show();\n                            }\n                        },\n                        fail: function(error) {\n                            console.error('Error when switching the menu item', error);\n                        }\n                    }]);\n                }\n            });\n        }\n    };\n});\n"],"names":["define","$","ajax","str","langStrings","init","get_strings","key","component","done","strings","activate","deactivate","fail","console","error","document","on","menu","this","closest","find","length","sectionId","attr","_$$closest$attr","replace","courseId","match","call","methodname","args","sectionid","courseid","response","menuItem","html","e","preventDefault","newvalue","newText","sectionButton","hide","removeClass","addClass","show","toggleLearningPlanSetting","append"],"mappings":"AAAAA,wCAAO,CAAC,SAAU,YAAa,aAAa,SAASC,EAAGC,KAAMC,SACtDC,YAAc,SAgBX,CACHC,KAAM,WAXCF,IAAIG,YAAY,CACnB,CAACC,IAAK,wBAAyBC,UAAW,sBAC1C,CAACD,IAAK,0BAA2BC,UAAW,wBAC7CC,MAAK,SAASC,SACbN,YAAYO,SAAWD,QAAQ,GAC/BN,YAAYQ,WAAaF,QAAQ,MAClCG,MAAK,WACJC,QAAQC,MAAM,yCAKIN,MAAK,WACnBR,EAAEe,UAAUC,GAAG,QAAS,qCAAqC,mCACrDC,KAAOjB,EAAEkB,MAAMC,QAAQ,aAAaC,KAAK,sBAExCH,KAAKI,QAAUJ,KAAKG,KAAK,2BAA2BC,kBAIrDC,kCAAYtB,EAAEkB,MAAMC,QAAQ,YAAYI,KAAK,wCAAjCC,gBAAwCC,QAAQ,WAAY,IACxEC,SAAW1B,EAAE,QAAQuB,KAAK,SAASI,MAAM,gBAC7CD,SAAWA,SAAWA,SAAS,GAAK,KAE/BJ,WAAcI,UAKnBzB,KAAK2B,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CACFC,UAAWT,UACXU,SAAUN,UAEdlB,KAAM,SAASyB,cACPC,SAAWlC,EAAE,6DACZmC,KAAK,8CACY,IAAbF,SAAiB9B,YAAYQ,WAAaR,YAAYO,WAC1DM,GAAG,SAAS,SAASoB,GAClBA,EAAEC,0BAsCaf,UAAWI,SAAUQ,UACpDjC,KAAK2B,KAAK,CAAC,CACPC,WAAY,2CACZC,KAAM,CACFC,UAAWT,UACXU,SAAUN,UAEdlB,KAAM,SAAS8B,cACPC,QAAwB,IAAbD,SAAiBnC,YAAYQ,WAAaR,YAAYO,SACrEwB,SAASC,KAAK,6CAA+CI,aAEzDC,cAAgBxC,EAAE,qBAAuBsB,UAAY,+BACxC,IAAbgB,UACAE,cAAcC,OACdxC,KAAK2B,KAAK,CAAC,CACPC,WAAY,iDACZC,KAAM,CACFE,SAAUN,SACVK,UAAWT,WAEfd,KAAM,WACFgC,cAAcpB,KAAK,KAAKsB,YAAY,YAAYC,SAAS,eAE7D/B,KAAM,SAASE,OACXD,QAAQC,MAAM,kCAAmCA,YAIzD0B,cAAcI,QAGtBhC,KAAM,SAASE,OACXD,QAAQC,MAAM,qCAAsCA,WArE5C+B,CAA0BvB,UAAWI,SAAUQ,aAGvDjB,KAAK6B,OAAOZ,cAERM,cAAgBxC,EAAE,YAAcsB,UAAY,8BAC/B,IAAbW,UACAO,cAAcC,OACdxC,KAAK2B,KAAK,CAAC,CACPC,WAAY,iDACZC,KAAM,CACFE,SAAUN,SACVK,UAAWT,WAEfd,KAAM,WACFgC,cAAcpB,KAAK,KAAKsB,YAAY,YAAYC,SAAS,eAE7D/B,KAAM,SAASE,OACXD,QAAQC,MAAM,kCAAmCA,YAIzD0B,cAAcI,QAGtBhC,KAAM,SAASE,OACXD,QAAQC,MAAM,oCAAqCA"}