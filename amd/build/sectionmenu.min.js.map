{"version":3,"file":"sectionmenu.min.js","sources":["../src/sectionmenu.js"],"sourcesContent":["define(['jquery', 'core/ajax'], function($, ajax) {\n    return {\n        init: function() {\n            console.log(\"Lernplan-Menüerweiterung geladen.\");\n\n            $(document).on('click', '.section-actions .dropdown-toggle', function() {\n                let menu = $(this).closest('.dropdown').find('.dropdown-menu');\n\n                if (!menu.length || menu.find('.learningplan-menu-item').length) {\n                    return;\n                }\n\n                let sectionId = $(this).closest('.section').attr('id')?.replace('section-', '');\n\n                let courseId = $('body').attr('class').match(/course-(\\d+)/);\n                courseId = courseId ? courseId[1] : null;\n\n                if (!sectionId || !courseId) {\n                    return;\n                }\n\n                // API Call: Prüfen, ob der Abschnitt bereits in der DB ist\n                ajax.call([{\n                    methodname: 'local_learningplan_get_section_option',\n                    args: {\n                        sectionid: sectionId,\n                        courseid: courseId\n                    },\n                    done: function(response) {\n                        // Button-Titel basierend auf dem Wert setzen\n                        let menuItem = $('<a href=\"#\" class=\"dropdown-item learningplan-menu-item\">')\n                            .html('<i class=\"icon fa fa-list-alt fa-fw\"></i> ' +\n                                (response == 1 ? 'Lernplan deaktivieren' : 'Lernplan aktivieren'))\n                            .on('click', function(e) {\n                                e.preventDefault();\n                                toggleLearningPlanSetting(sectionId, courseId, menuItem);\n                            });\n\n                        menu.append(menuItem);\n                        console.log(\"Menüeintrag für Abschnitt \" + sectionId + \" hinzugefügt.\");\n\n                        // **Section-Button ein-/ausblenden**\n                        let sectionButton = $('.section-' + sectionId + ' .learningplan-save-button');\n                        if (response === 0) {\n                            sectionButton.hide();\n\n                            // **Lernplan-Eintrag entfernen, falls vorhanden**\n                            ajax.call([{\n                                methodname: 'local_learningplan_delete_section_data_for_all',\n                                args: {\n                                    courseid: courseId,\n                                    sectionid: sectionId\n                                },\n                                done: function() {\n                                    console.log(\"Lernplan-Eintrag für Abschnitt \" + sectionId + \" wurde für alle User entfernt.\");\n                                    sectionButton.find('i').removeClass('fa-trash').addClass('fa-save');\n                                    sectionButton.removeClass('btn-danger').addClass('btn-primary');\n                                },\n                                fail: function(error) {\n                                    console.error('Fehler beim Entfernen des Lernplan-Eintrags:', error);\n                                    console.log('Section id=' + sectionId + ' Courseid=' + courseId);\n                                    console.log('Nachricht aus der Basis Funktion');\n                                }\n                            }]);\n                        } else {\n                            sectionButton.show();\n                        }\n                    },\n                    fail: function(error) {\n                        console.error('Fehler beim Abrufen der Einstellung:', error);\n                    }\n                }]);\n            });\n\n            /**\n             * @param {number} sectionId\n             * @param {number} courseId\n             * @param {number} menuItem\n             */\n            function toggleLearningPlanSetting(sectionId, courseId, menuItem) {\n                ajax.call([{\n                    methodname: 'local_learningplan_toggle_section_option',\n                    args: {\n                        sectionid: sectionId,\n                        courseid: courseId\n                    },\n                    done: function(newvalue) {\n                        let newText = (newvalue == 1 ? 'Lernplan deaktivieren' : 'Lernplan aktivieren');\n                        menuItem.html('<i class=\"icon fa fa-list-alt fa-fw\"></i> ' + newText);\n                        console.log(\"Lernplan-Einstellung für Abschnitt \" + sectionId + \" geändert!\");\n\n                        // **Section-Button aktualisieren**\n                        let sectionButton = $('[data-section-id=\"' + sectionId + '\"].learningplan-save-button');\n                        console.log(\"Suche Button für sectionId:\", sectionId);\n                        console.log(\"Gefundene Elemente:\", sectionButton.length);\n\n                        if (newvalue === 0) {\n                            sectionButton.hide();\n\n                            // **Lernplan-Eintrag entfernen, falls vorhanden**\n                            ajax.call([{\n                                methodname: 'local_learningplan_delete_section_data_for_all',\n                                args: {\n                                    courseid: courseId,\n                                    sectionid: sectionId\n                                },\n                                done: function() {\n                                    console.log(\"Lernplan-Eintrag für Abschnitt \" + sectionId + \" wurde für alle User entfernt.\");\n                                    sectionButton.find('i').removeClass('fa-trash').addClass('fa-save');\n                                    sectionButton.removeClass('btn-danger').addClass('btn-primary');\n                                },\n                                fail: function(error) {\n                                    console.error('Fehler beim Entfernen des Lernplan-Eintrags:', error);\n                                    console.log('Section id=' + sectionId + ' Courseid=' + courseId);\n                                    console.log('Nachricht aus der Toggle Funktion');\n                                }\n                            }]);\n                        } else {\n                            sectionButton.show();\n                        }\n                    },\n                    fail: function(error) {\n                        console.error('Fehler beim Umschalten:', error);\n                    }\n                }]);\n            }\n        }\n    };\n});\n"],"names":["define","$","ajax","init","console","log","document","on","menu","this","closest","find","length","sectionId","attr","_$$closest$attr","replace","courseId","match","call","methodname","args","sectionid","courseid","done","response","menuItem","html","e","preventDefault","newvalue","newText","sectionButton","hide","removeClass","addClass","fail","error","show","toggleLearningPlanSetting","append"],"mappings":"AAAAA,wCAAO,CAAC,SAAU,cAAc,SAASC,EAAGC,YACjC,CACHC,KAAM,WACFC,QAAQC,IAAI,qCAEZJ,EAAEK,UAAUC,GAAG,QAAS,qCAAqC,mCACrDC,KAAOP,EAAEQ,MAAMC,QAAQ,aAAaC,KAAK,sBAExCH,KAAKI,QAAUJ,KAAKG,KAAK,2BAA2BC,kBAIrDC,kCAAYZ,EAAEQ,MAAMC,QAAQ,YAAYI,KAAK,wCAAjCC,gBAAwCC,QAAQ,WAAY,IAExEC,SAAWhB,EAAE,QAAQa,KAAK,SAASI,MAAM,gBAC7CD,SAAWA,SAAWA,SAAS,GAAK,KAE/BJ,WAAcI,UAKnBf,KAAKiB,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CACFC,UAAWT,UACXU,SAAUN,UAEdO,KAAM,SAASC,cAEPC,SAAWzB,EAAE,6DACZ0B,KAAK,8CACW,GAAZF,SAAgB,wBAA0B,wBAC9ClB,GAAG,SAAS,SAASqB,GAClBA,EAAEC,0BA6CahB,UAAWI,SAAUS,UACpDxB,KAAKiB,KAAK,CAAC,CACPC,WAAY,2CACZC,KAAM,CACFC,UAAWT,UACXU,SAAUN,UAEdO,KAAM,SAASM,cACPC,QAAuB,GAAZD,SAAgB,wBAA0B,sBACzDJ,SAASC,KAAK,6CAA+CI,SAC7D3B,QAAQC,IAAI,sCAAwCQ,UAAY,kBAG5DmB,cAAgB/B,EAAE,qBAAuBY,UAAY,+BACzDT,QAAQC,IAAI,8BAA+BQ,WAC3CT,QAAQC,IAAI,sBAAuB2B,cAAcpB,QAEhC,IAAbkB,UACAE,cAAcC,OAGd/B,KAAKiB,KAAK,CAAC,CACPC,WAAY,iDACZC,KAAM,CACFE,SAAUN,SACVK,UAAWT,WAEfW,KAAM,WACFpB,QAAQC,IAAI,kCAAoCQ,UAAY,kCAC5DmB,cAAcrB,KAAK,KAAKuB,YAAY,YAAYC,SAAS,WACzDH,cAAcE,YAAY,cAAcC,SAAS,gBAErDC,KAAM,SAASC,OACXjC,QAAQiC,MAAM,+CAAgDA,OAC9DjC,QAAQC,IAAI,cAAgBQ,UAAY,aAAeI,UACvDb,QAAQC,IAAI,0CAIpB2B,cAAcM,QAGtBF,KAAM,SAASC,OACXjC,QAAQiC,MAAM,0BAA2BA,WAvFjCE,CAA0B1B,UAAWI,SAAUS,aAGvDlB,KAAKgC,OAAOd,UACZtB,QAAQC,IAAI,6BAA+BQ,UAAY,qBAGnDmB,cAAgB/B,EAAE,YAAcY,UAAY,8BAC/B,IAAbY,UACAO,cAAcC,OAGd/B,KAAKiB,KAAK,CAAC,CACPC,WAAY,iDACZC,KAAM,CACFE,SAAUN,SACVK,UAAWT,WAEfW,KAAM,WACFpB,QAAQC,IAAI,kCAAoCQ,UAAY,kCAC5DmB,cAAcrB,KAAK,KAAKuB,YAAY,YAAYC,SAAS,WACzDH,cAAcE,YAAY,cAAcC,SAAS,gBAErDC,KAAM,SAASC,OACXjC,QAAQiC,MAAM,+CAAgDA,OAC9DjC,QAAQC,IAAI,cAAgBQ,UAAY,aAAeI,UACvDb,QAAQC,IAAI,yCAIpB2B,cAAcM,QAGtBF,KAAM,SAASC,OACXjC,QAAQiC,MAAM,uCAAwCA"}