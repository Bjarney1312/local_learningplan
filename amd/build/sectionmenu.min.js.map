{"version":3,"file":"sectionmenu.min.js","sources":["../src/sectionmenu.js"],"sourcesContent":["define(['jquery', 'core/ajax'], function($, ajax) {\n    return {\n        init: function() {\n            console.log(\"Lernplan-Menüerweiterung geladen.\");\n\n            $(document).on('click', '.section-actions .dropdown-toggle', function() {\n                let menu = $(this).closest('.dropdown').find('.dropdown-menu');\n\n                if (!menu.length || menu.find('.learningplan-menu-item').length) {\n                    return;\n                }\n\n                let sectionId = $(this).closest('.section-actions').data('sectionid');\n                let courseId = $('body').attr('class').match(/course-(\\d+)/);\n                courseId = courseId ? courseId[1] : null;\n\n                if (!sectionId || !courseId) {\n                    return;\n                }\n\n                // API Call: Prüfen, ob der Abschnitt bereits in der DB ist\n                ajax.call([{\n                    methodname: 'local_learningplan_get_section_option',\n                    args: {\n                        sectionid: sectionId,\n                        courseid: courseId\n                    },\n                    done: function(response) {\n                        // Button-Titel basierend auf dem Wert setzen\n                        let menuItem = $('<a href=\"#\" class=\"dropdown-item learningplan-menu-item\">')\n                            .html('<i class=\"icon fa fa-list-alt fa-fw\"></i> ' +\n                                (response == 1 ? 'Nicht zum Lernplan hinzufügbar' : 'Zum Lernplan hinzufügbar'))\n                            .on('click', function(e) {\n                                e.preventDefault();\n                                toggleLearningPlanSetting(sectionId, courseId, menuItem);\n                            });\n\n                        menu.append(menuItem);\n                        console.log(\"Menüeintrag für Abschnitt \" + sectionId + \" hinzugefügt.\");\n\n                        // **Section-Button ein-/ausblenden**\n                        let sectionButton = $('.section-' + sectionId + ' .learningplan-save-button');\n                        if (response == 0) {\n                            sectionButton.hide();\n                        } else {\n                            sectionButton.show();\n                        }\n                    },\n                    fail: function(error) {\n                        console.error('Fehler beim Abrufen der Einstellung:', error);\n                    }\n                }]);\n            });\n\n            /**\n             * @param {number} sectionId\n             * @param {number} courseId\n             * @param {number} menuItem\n             */\n            function toggleLearningPlanSetting(sectionId, courseId, menuItem) {\n                ajax.call([{\n                    methodname: 'local_learningplan_toggle_section_option',\n                    args: {\n                        sectionid: sectionId,\n                        courseid: courseId\n                    },\n                    done: function(newvalue) {\n                        let newText = (newvalue == 1 ? 'Nicht zum Lernplan hinzufügbar' : 'Zum Lernplan hinzufügbar');\n                        menuItem.html('<i class=\"icon fa fa-list-alt fa-fw\"></i> ' + newText);\n                        console.log(\"Lernplan-Einstellung für Abschnitt \" + sectionId + \" geändert!\");\n\n                        // **Section-Button aktualisieren**\n                        let sectionButton = $('.section-' + sectionId + ' .learningplan-save-button');\n                        if (newvalue == 0) {\n                            sectionButton.hide();\n                        } else {\n                            sectionButton.show();\n                        }\n                    },\n                    fail: function(error) {\n                        console.error('Fehler beim Umschalten:', error);\n                    }\n                }]);\n            }\n        }\n    };\n});\n"],"names":["define","$","ajax","init","console","log","document","on","menu","this","closest","find","length","sectionId","data","courseId","attr","match","call","methodname","args","sectionid","courseid","done","response","menuItem","html","e","preventDefault","newvalue","newText","sectionButton","hide","show","fail","error","toggleLearningPlanSetting","append"],"mappings":"AAAAA,wCAAO,CAAC,SAAU,cAAc,SAASC,EAAGC,YACjC,CACHC,KAAM,WACFC,QAAQC,IAAI,qCAEZJ,EAAEK,UAAUC,GAAG,QAAS,qCAAqC,eACrDC,KAAOP,EAAEQ,MAAMC,QAAQ,aAAaC,KAAK,sBAExCH,KAAKI,QAAUJ,KAAKG,KAAK,2BAA2BC,kBAIrDC,UAAYZ,EAAEQ,MAAMC,QAAQ,oBAAoBI,KAAK,aACrDC,SAAWd,EAAE,QAAQe,KAAK,SAASC,MAAM,gBAC7CF,SAAWA,SAAWA,SAAS,GAAK,KAE/BF,WAAcE,UAKnBb,KAAKgB,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CACFC,UAAWR,UACXS,SAAUP,UAEdQ,KAAM,SAASC,cAEPC,SAAWxB,EAAE,6DACZyB,KAAK,8CACW,GAAZF,SAAgB,iCAAmC,6BACvDjB,GAAG,SAAS,SAASoB,GAClBA,EAAEC,0BA0Baf,UAAWE,SAAUU,UACpDvB,KAAKgB,KAAK,CAAC,CACPC,WAAY,2CACZC,KAAM,CACFC,UAAWR,UACXS,SAAUP,UAEdQ,KAAM,SAASM,cACPC,QAAuB,GAAZD,SAAgB,iCAAmC,2BAClEJ,SAASC,KAAK,6CAA+CI,SAC7D1B,QAAQC,IAAI,sCAAwCQ,UAAY,kBAG5DkB,cAAgB9B,EAAE,YAAcY,UAAY,8BAChC,GAAZgB,SACAE,cAAcC,OAEdD,cAAcE,QAGtBC,KAAM,SAASC,OACX/B,QAAQ+B,MAAM,0BAA2BA,WA9CjCC,CAA0BvB,UAAWE,SAAUU,aAGvDjB,KAAK6B,OAAOZ,UACZrB,QAAQC,IAAI,6BAA+BQ,UAAY,qBAGnDkB,cAAgB9B,EAAE,YAAcY,UAAY,8BAChC,GAAZW,SACAO,cAAcC,OAEdD,cAAcE,QAGtBC,KAAM,SAASC,OACX/B,QAAQ+B,MAAM,uCAAwCA"}