{"version":3,"file":"sectionmenu.min.js","sources":["../src/sectionmenu.js"],"sourcesContent":["define(['jquery', 'core/ajax'], function($, ajax) {\n    return {\n        init: function() {\n\n            $(document).on('click', '.section-actions .dropdown-toggle', function() {\n                let menu = $(this).closest('.dropdown').find('.dropdown-menu');\n\n                if (!menu.length || menu.find('.learningplan-menu-item').length) {\n                    return;\n                }\n\n                let sectionId = $(this).closest('.section').attr('id')?.replace('section-', '');\n\n                let courseId = $('body').attr('class').match(/course-(\\d+)/);\n                courseId = courseId ? courseId[1] : null;\n\n                if (!sectionId || !courseId) {\n                    return;\n                }\n\n                // API Call: Check whether the section is already in the DB\n                ajax.call([{\n                    methodname: 'local_learningplan_get_section_option',\n                    args: {\n                        sectionid: sectionId,\n                        courseid: courseId\n                    },\n                    done: function(response) {\n                        // Set button title based on the value allow_learningplan\n                        let menuItem = $('<a href=\"#\" class=\"dropdown-item learningplan-menu-item\">')\n                            .html('<i class=\"icon fa fa-list-alt fa-fw\"></i> ' +\n                                (response === 1 ? 'Lernplan deaktivieren' : 'Lernplan aktivieren'))\n                            .on('click', function(e) {\n                                e.preventDefault();\n                                toggleLearningPlanSetting(sectionId, courseId, menuItem);\n                            });\n\n                        menu.append(menuItem);\n\n                        // Show/hide section button\n                        let sectionButton = $('.section-' + sectionId + ' .learningplan-save-button');\n                        if (response === 0) {\n                            sectionButton.hide();\n\n                            // Remove learning plan entries from the database, if present\n                            ajax.call([{\n                                methodname: 'local_learningplan_delete_section_data_for_all',\n                                args: {\n                                    courseid: courseId,\n                                    sectionid: sectionId\n                                },\n                                done: function() {\n                                    sectionButton.find('i').removeClass('fa-trash').addClass('fa-save');\n                                    sectionButton.removeClass('btn-danger').addClass('btn-primary');\n                                },\n                                fail: function(error) {\n                                    console.error('Error when removing the learning plan entries:', error);\n                                }\n                            }]);\n                        } else {\n                            sectionButton.show();\n                        }\n                    },\n                    fail: function(error) {\n                        console.error('Error when retrieving the setting:', error);\n                    }\n                }]);\n            });\n\n            /**\n             * Updates the item menu to enable or disable the option to add the section to the learning plan.\n             * @param {number} sectionId Number of the section in the course\n             * @param {number} courseId ID of the course\n             * @param {number} menuItem Menu Item\n             */\n            function toggleLearningPlanSetting(sectionId, courseId, menuItem) {\n                ajax.call([{\n                    methodname: 'local_learningplan_toggle_section_option',\n                    args: {\n                        sectionid: sectionId,\n                        courseid: courseId\n                    },\n                    done: function(newvalue) {\n                        let newText = (newvalue === 1 ? 'Lernplan deaktivieren' : 'Lernplan aktivieren');\n                        menuItem.html('<i class=\"icon fa fa-list-alt fa-fw\"></i> ' + newText);\n\n                        // Update section button\n                        let sectionButton = $('[data-section-id=\"' + sectionId + '\"].learningplan-save-button');\n\n                        if (newvalue === 0) {\n                            sectionButton.hide();\n\n                            // Remove learning plan entries from the database, if present\n                            ajax.call([{\n                                methodname: 'local_learningplan_delete_section_data_for_all',\n                                args: {\n                                    courseid: courseId,\n                                    sectionid: sectionId\n                                },\n                                done: function() {\n                                    sectionButton.find('i').removeClass('fa-trash').addClass('fa-save');\n                                    sectionButton.removeClass('btn-danger').addClass('btn-primary');\n                                },\n                                fail: function(error) {\n                                    console.error('Error when removing the learning plan entries:', error);\n                                }\n                            }]);\n                        } else {\n                            sectionButton.show();\n                        }\n                    },\n                    fail: function(error) {\n                        console.error('Error when switching menu item:', error);\n                    }\n                }]);\n            }\n        }\n    };\n});\n"],"names":["define","$","ajax","init","document","on","menu","this","closest","find","length","sectionId","attr","_$$closest$attr","replace","courseId","match","call","methodname","args","sectionid","courseid","done","response","menuItem","html","e","preventDefault","newvalue","newText","sectionButton","hide","removeClass","addClass","fail","error","console","show","toggleLearningPlanSetting","append"],"mappings":"AAAAA,wCAAO,CAAC,SAAU,cAAc,SAASC,EAAGC,YACjC,CACHC,KAAM,WAEFF,EAAEG,UAAUC,GAAG,QAAS,qCAAqC,mCACrDC,KAAOL,EAAEM,MAAMC,QAAQ,aAAaC,KAAK,sBAExCH,KAAKI,QAAUJ,KAAKG,KAAK,2BAA2BC,kBAIrDC,kCAAYV,EAAEM,MAAMC,QAAQ,YAAYI,KAAK,wCAAjCC,gBAAwCC,QAAQ,WAAY,IAExEC,SAAWd,EAAE,QAAQW,KAAK,SAASI,MAAM,gBAC7CD,SAAWA,SAAWA,SAAS,GAAK,KAE/BJ,WAAcI,UAKnBb,KAAKe,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CACFC,UAAWT,UACXU,SAAUN,UAEdO,KAAM,SAASC,cAEPC,SAAWvB,EAAE,6DACZwB,KAAK,8CACY,IAAbF,SAAiB,wBAA0B,wBAC/ClB,GAAG,SAAS,SAASqB,GAClBA,EAAEC,0BA0CahB,UAAWI,SAAUS,UACpDtB,KAAKe,KAAK,CAAC,CACPC,WAAY,2CACZC,KAAM,CACFC,UAAWT,UACXU,SAAUN,UAEdO,KAAM,SAASM,cACPC,QAAwB,IAAbD,SAAiB,wBAA0B,sBAC1DJ,SAASC,KAAK,6CAA+CI,aAGzDC,cAAgB7B,EAAE,qBAAuBU,UAAY,+BAExC,IAAbiB,UACAE,cAAcC,OAGd7B,KAAKe,KAAK,CAAC,CACPC,WAAY,iDACZC,KAAM,CACFE,SAAUN,SACVK,UAAWT,WAEfW,KAAM,WACFQ,cAAcrB,KAAK,KAAKuB,YAAY,YAAYC,SAAS,WACzDH,cAAcE,YAAY,cAAcC,SAAS,gBAErDC,KAAM,SAASC,OACXC,QAAQD,MAAM,iDAAkDA,YAIxEL,cAAcO,QAGtBH,KAAM,SAASC,OACXC,QAAQD,MAAM,kCAAmCA,WA9EzCG,CAA0B3B,UAAWI,SAAUS,aAGvDlB,KAAKiC,OAAOf,cAGRM,cAAgB7B,EAAE,YAAcU,UAAY,8BAC/B,IAAbY,UACAO,cAAcC,OAGd7B,KAAKe,KAAK,CAAC,CACPC,WAAY,iDACZC,KAAM,CACFE,SAAUN,SACVK,UAAWT,WAEfW,KAAM,WACFQ,cAAcrB,KAAK,KAAKuB,YAAY,YAAYC,SAAS,WACzDH,cAAcE,YAAY,cAAcC,SAAS,gBAErDC,KAAM,SAASC,OACXC,QAAQD,MAAM,iDAAkDA,YAIxEL,cAAcO,QAGtBH,KAAM,SAASC,OACXC,QAAQD,MAAM,qCAAsCA"}