define("local_learningplan/sectionmenu",["jquery","core/ajax","core/str"],(function($,ajax,str){let langStrings={};return{init:function(){str.get_strings([{key:"learningplan_activate",component:"local_learningplan"},{key:"learningplan_deactivate",component:"local_learningplan"}]).done((function(strings){langStrings.activate=strings[0],langStrings.deactivate=strings[1]})).fail((function(){console.error("Error loading the language strings")})).done((function(){$(document).on("click",".section-actions .dropdown-toggle",(function(){var _$$closest$attr;let menu=$(this).closest(".dropdown").find(".dropdown-menu");if(!menu.length||menu.find(".learningplan-menu-item").length)return;let sectionId=null===(_$$closest$attr=$(this).closest(".section").attr("id"))||void 0===_$$closest$attr?void 0:_$$closest$attr.replace("section-",""),courseId=$("body").attr("class").match(/course-(\d+)/);courseId=courseId?courseId[1]:null,sectionId&&courseId&&ajax.call([{methodname:"local_learningplan_get_section_option",args:{sectionid:sectionId,courseid:courseId},done:function(response){let menuItem=$('<a href="#" class="dropdown-item learningplan-menu-item">').html('<i class="icon fa fa-list-alt fa-fw"></i> '+(1===response?langStrings.deactivate:langStrings.activate)).on("click",(function(e){e.preventDefault(),function(sectionId,courseId,menuItem){ajax.call([{methodname:"local_learningplan_toggle_section_option",args:{sectionid:sectionId,courseid:courseId},done:function(newvalue){let newText=1===newvalue?langStrings.deactivate:langStrings.activate;menuItem.html('<i class="icon fa fa-list-alt fa-fw"></i> '+newText);let sectionButton=$('[data-section-id="'+sectionId+'"].learningplan-save-button');0===newvalue?(sectionButton.hide(),ajax.call([{methodname:"local_learningplan_delete_section_data_for_all",args:{courseid:courseId,sectionid:sectionId},done:function(){sectionButton.find("i").removeClass("fa-solid").addClass("fa-regular")},fail:function(error){console.error("Error when removing the entries",error)}}])):sectionButton.show()},fail:function(error){console.error("Error when switching the menu item",error)}}])}(sectionId,courseId,menuItem)}));menu.append(menuItem);let sectionButton=$(".section-"+sectionId+" .learningplan-save-button");0===response?(sectionButton.hide(),ajax.call([{methodname:"local_learningplan_delete_section_data_for_all",args:{courseid:courseId,sectionid:sectionId},done:function(){sectionButton.find("i").removeClass("fa-solid").addClass("fa-regular")},fail:function(error){console.error("Error when removing the entries",error)}}])):sectionButton.show()},fail:function(error){console.error("Error when retrieving the setting",error)}}])}))}))}}}));

//# sourceMappingURL=sectionmenu.min.js.map